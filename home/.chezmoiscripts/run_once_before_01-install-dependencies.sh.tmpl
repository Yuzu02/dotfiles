{{ if eq .chezmoi.os "linux" -}}
#!/bin/bash
# ==============================================================================
# 01-INSTALL-DEPENDENCIES
# Essential system packages for Arch/WSL
# ==============================================================================

set -euo pipefail

# Colors
BLUE='\033[0;34m'
GREEN='\033[0;32m'
NC='\033[0m'

echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BLUE}  ðŸ“¦ Installing Base Dependencies${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# ============================================================================
# SUDO WRAPPER
# ============================================================================
if [ "$(id -u)" -eq 0 ]; then
    SUDO=""
else
    SUDO="sudo"
    if ! command -v sudo &>/dev/null; then
        echo -e "${RED}ERROR: Not running as root and sudo is not installed!${NC}"
        exit 1
    fi
fi

# ============================================================================
# PACKAGE MANAGER DETECTION
# ============================================================================
if command -v paru &>/dev/null; then
    PKG_INSTALL="paru -S --needed --noconfirm"
elif command -v yay &>/dev/null; then
    PKG_INSTALL="yay -S --needed --noconfirm"
elif command -v pacman &>/dev/null; then
    PKG_INSTALL="$SUDO pacman -S --needed --noconfirm"
elif command -v apt-get &>/dev/null; then
    PKG_INSTALL="$SUDO apt-get install -y"
elif command -v dnf &>/dev/null; then
    PKG_INSTALL="$SUDO dnf install -y"
else
    echo "No supported package manager found!"
    exit 1
fi

# Core utilities
CORE_PKGS=(
    git
    curl
    wget
    unzip
    tar
    gzip
)

# Development tools
DEV_PKGS=(
    base-devel
    cmake
    gcc
    make
)

# Install packages silently
if command -v pacman &>/dev/null; then
    $PKG_INSTALL "${CORE_PKGS[@]}" "${DEV_PKGS[@]}" &>/dev/null
elif command -v apt-get &>/dev/null; then
    sudo apt-get update &>/dev/null
    $PKG_INSTALL "${CORE_PKGS[@]}" build-essential &>/dev/null
elif command -v dnf &>/dev/null; then
    $PKG_INSTALL "${CORE_PKGS[@]}" @development-tools &>/dev/null
fi

echo -e "${GREEN}âœ“ Base dependencies installed${NC}"
{{ end -}}
