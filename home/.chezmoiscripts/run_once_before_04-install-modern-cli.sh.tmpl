{{ if eq .chezmoi.os "linux" -}}
#!/bin/bash
# ==============================================================================
# 04-INSTALL-MODERN-CLI
# Modern CLI replacements: eza, bat, ripgrep, fd, delta, btop, etc.
# ==============================================================================

set -euo pipefail

# Colors
BLUE='\033[0;34m'
GREEN='\033[0;32m'
NC='\033[0m'

echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${BLUE}  ⚡ Installing Modern CLI Tools${NC}"
echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"

# ============================================================================
# SUDO WRAPPER
# ============================================================================
if [ "$(id -u)" -eq 0 ]; then
    SUDO=""
else
    SUDO="sudo"
fi

# ============================================================================
# PACKAGE MANAGER DETECTION
# ============================================================================
if command -v paru &>/dev/null; then
    PKG_INSTALL="paru -S --needed --noconfirm"
elif command -v yay &>/dev/null; then
    PKG_INSTALL="yay -S --needed --noconfirm"
elif command -v pacman &>/dev/null; then
    PKG_INSTALL="$SUDO pacman -S --needed --noconfirm"
else
    PKG_INSTALL=""
fi

# Modern CLI replacements
CLI_PKGS=(
    eza bat ripgrep fd
    btop dust duf procs
    git-delta lazygit
    yazi zellij
    neovim mise
)

if [ -n "$PKG_INSTALL" ]; then
    $PKG_INSTALL "${CLI_PKGS[@]}" &>/dev/null
fi

echo -e "${GREEN}✓ Modern CLI tools installed${NC}"
{{ end -}}
    $PKG_INSTALL "${CLI_PKGS[@]}" || true
fi

# Install fastfetch
if ! command -v fastfetch &>/dev/null; then
    if [ -n "$PKG_INSTALL" ]; then
        $PKG_INSTALL fastfetch || true
    fi
fi

echo -e "\033[0;32m>>>>> Modern CLI tools installed <<<<<\033[0m"
{{ end -}}
