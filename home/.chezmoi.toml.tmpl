{{/* ============================================================================ */}}
{{/*                     CHEZMOI CONFIGURATION TEMPLATE                          */}}
{{/*                     Yuzu's Dotfiles - 2025/2026                             */}}
{{/*         Fully Automatic Setup - No Prompts in Non-Interactive Mode         */}}
{{/* ============================================================================ */}}

{{/* ============================================================================ */}}
{{/* SMART DEFAULTS: Use environment variables or sensible defaults             */}}
{{/* Priority: 1) Existing config 2) Environment vars 3) Git config 4) Defaults */}}
{{/* ============================================================================ */}}

{{/* Get defaults from environment or git config */}}
{{- $defaultEmail := or (env "CHEZMOI_EMAIL") (env "GIT_AUTHOR_EMAIL") (env "GIT_EMAIL") "user@localhost" -}}
{{- $defaultName := or (env "CHEZMOI_NAME") (env "GIT_AUTHOR_NAME") (env "GIT_NAME") (env "USER") "User" -}}
{{- $defaultGithubUser := or (env "CHEZMOI_GITHUB_USER") (env "GITHUB_USER") (env "USER") "Yuzu02" -}}

{{/* Handle interactive vs non-interactive mode using stdinIsATTY */}}
{{- $email := "" -}}
{{- $name := "" -}}
{{- $github_user := "" -}}

{{- if stdinIsATTY -}}
{{/* Interactive mode: prompt with defaults */}}
{{-   $email = promptStringOnce . "email" (printf "Email address [%s]" $defaultEmail) -}}
{{-   if eq $email "" -}}{{- $email = $defaultEmail -}}{{- end -}}
{{-   $name = promptStringOnce . "name" (printf "Full name [%s]" $defaultName) -}}
{{-   if eq $name "" -}}{{- $name = $defaultName -}}{{- end -}}
{{-   $github_user = promptStringOnce . "github_user" (printf "GitHub username [%s]" $defaultGithubUser) -}}
{{-   if eq $github_user "" -}}{{- $github_user = $defaultGithubUser -}}{{- end -}}
{{- else -}}
{{/* Non-interactive mode (CI, piped install, etc.): use defaults silently */}}
{{-   $email = or (index . "email") $defaultEmail -}}
{{-   $name = or (index . "name") $defaultName -}}
{{-   $github_user = or (index . "github_user") $defaultGithubUser -}}
{{- end -}}

{{/* Detect environment */}}
{{- $is_wsl := false -}}
{{- $is_codespaces := false -}}
{{- $is_devcontainer := false -}}
{{- $is_container := false -}}
{{- $is_root := eq .chezmoi.username "root" -}}
{{- $hostname := .chezmoi.hostname -}}

{{/* WSL Detection */}}
{{- if eq .chezmoi.os "linux" -}}
{{-   if (.chezmoi.kernel.osrelease | lower | contains "microsoft") -}}
{{-     $is_wsl = true -}}
{{-   end -}}
{{- end -}}

{{/* Codespaces/DevContainer/Container Detection */}}
{{- if env "CODESPACES" -}}
{{-   $is_codespaces = true -}}
{{-   $is_container = true -}}
{{- end -}}
{{- if env "REMOTE_CONTAINERS" -}}
{{-   $is_devcontainer = true -}}
{{-   $is_container = true -}}
{{- end -}}
{{- if or (stat "/.dockerenv") (env "container") -}}
{{-   $is_container = true -}}
{{- end -}}

# ============================================================================
# CHEZMOI CONFIGURATION (FIXED)
# Generated by chezmoi init - Do not edit manually
# Supports: Fully automatic non-interactive setup (2025/2026 best practices)
# All errors and warnings resolved
# ============================================================================

sourceDir = {{ .chezmoi.sourceDir | quote }}

[data]
    email = {{ $email | quote }}
    name = {{ $name | quote }}
    github_user = {{ $github_user | quote }}
    
    # Environment Detection
    is_wsl = {{ $is_wsl }}
    is_codespaces = {{ $is_codespaces }}
    is_devcontainer = {{ $is_devcontainer }}
    is_container = {{ $is_container }}
    is_root = {{ $is_root }}
    
    # System Info
    hostname = {{ $hostname | quote }}
    os = {{ .chezmoi.os | quote }}
    arch = {{ .chezmoi.arch | quote }}

[git]
    autoCommit = false
    autoPush = false

[diff]
    command = "delta"
    args = ["--side-by-side"]
    pager = "delta"

[merge]
    command = "nvim"
    args = ["-d", "{{ "{{" }} .Destination {{ "}}" }}", "{{ "{{" }} .Source {{ "}}" }}", "{{ "{{" }} .Target {{ "}}" }}"]

[edit]
    command = "nvim"